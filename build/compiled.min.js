(function c(d,e,t){function a(i,o){if(!e[i]){if(!d[i]){var n="function"==typeof require&&require;if(!o&&n)return n(i,!0);if(r)return r(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var y=e[i]={exports:{}};d[i][0].call(y.exports,function(t){var e=d[i][1][t];return a(e?e:t)},y,y.exports,c,d,e,t)}return e[i].exports}for(var r="function"==typeof require&&require,l=0;l<t.length;l++)a(t[l]);return a})({1:[function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),o=e("./lib/glob"),r=e("./lib/log"),l=e("./lib/debugger"),i=e("./lib/mouse"),n=e("./lib/graphics"),s=e("./lib/spriteset"),c=e("./lib/sprite"),d=e("./lib/gelement"),y=e("./lib/physics"),u=e("./lib/keyboard"),p=e("./lib/world"),g=e("./lib/audio"),v=e("./lib/loader"),h=function(){function e(a){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(t(this,e),this.canvas="string"==typeof a?document.getElementById(a):a,!this.canvas)throw new Error("Undefined canvas ID");this.context=this.c=this.canvas.getContext("2d"),this.options=Object.assign(e.defaults(),r),this.gamedebugger=new l(this.canvas),this.loader=new v,this.mouse=new i(this.canvas),this.keyboard=new u(this.canvas),this.audio=new g(this.options.audiochannels),this.world=new p(this,this.options.world),"dev"===this.options.env&&(this.dev=!0,this.gamedebugger.cast()),this.timing={delta:0,ctime:0,frame:0,framerate:1e3/this.options.fps},this.width=this.options.width||this.canvas.style.width||this.canvas.width||o.innerWidth,this.height=this.options.height||this.canvas.style.height||this.canvas.height||o.innerHeight,this.bindResize(),this.resize()}return a(e,null,[{key:"defaults",value:function(){return{bgcolor:"#eaeff2",fps:60,env:"prod"}}}]),a(e,[{key:"resize",value:function(){var e=this.width,t=this.height;this.canvas.width=e,this.canvas.height=t,this.world.resize(e,t),r("Game","Handled resized at "+e+" x "+t)}},{key:"bindResize",value:function(){var e=this;o.addEventListener("resize",function(){return e.resize()})}},{key:"start",value:function(){var e=this;if(r("Game","Starting engine"),!this.world.hasStage())throw new Error("[Game] Cannot start game without a stage");return this.resize(),this.frameRequest=requestAnimationFrame(function(t){e.draw(t)}),this}},{key:"update",value:function(){return this.gamedebugger.ping(),this.world.update(),this}},{key:"draw",value:function(e){var t=this,a=this.timing.ctime-e;return a<this.timing.framerate&&(this.timing.ctime=e,this.timing.frame++,this.update(),this.world.draw()),this.frameRequest=requestAnimationFrame(function(e){t.draw(e)}),this}},{key:"loadFromRemote",value:function(e,t,a){"stage"===e?this.loader.loadStage(t,this,a):"world"===e?this.loader.loadWorld(t,this,a):void 0}},{key:"createStage",value:function(){var e;return(e=this.world).createStage.apply(e,arguments)}}]),e}();o.SideQuest={Game:h,SpriteSet:s,Sprite:c,GraphicElement:d,Physics:y,Keyboard:u,Mouse:i,World:p,Audio:g,log:r}},{"./lib/audio":4,"./lib/debugger":6,"./lib/gelement":8,"./lib/glob":9,"./lib/graphics":10,"./lib/keyboard":11,"./lib/loader":12,"./lib/log":13,"./lib/mouse":14,"./lib/physics":15,"./lib/sprite":16,"./lib/spriteset":17,"./lib/world":18}],2:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),r=function(){function e(){a(this,e),this.hooks={collide:[]},this.state="neutral",this.facing="right",this.initialstate=this.state}return o(e,[{key:"draw",value:function(e,t,a,o,r){return{x:t,y:a,w:o,h:r}}},{key:"on",value:function(e,t){this.hooks[e]||(this.hooks[e]=[]),this.hooks[e].push(t)}},{key:"collide",value:function(e,t){var a=this,o=!0;return this.hooks.collide.forEach(function(r){r(a,e,t)||(o=!1)}),o}},{key:"addState",value:function(){}},{key:"changeState",value:function(){}},{key:"updateState",value:function(){}},{key:"currentState",get:function(){return this.state}}]),e}();t.exports=r},{}],3:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=e("./abstract/drawable"),i=e("./physics"),n=function(e){function t(){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return r(t,e),t}(l);t.exports=n},{"./abstract/drawable":2,"./physics":15}],4:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),r=e("./log"),l=e("./loader"),i={},n=function(){function e(){a(this,e),this.ready=!1}return o(e,[{key:"setBuffer",value:function(e){this.buffer=e,this.ready=!0}}]),e}(),s=function(){function e(){a(this,e),this.context=new AudioContext,this.source}return o(e,[{key:"play",value:function(e){var t=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,o=arguments[2];this.context.decodeAudioData(i[e].buffer,function(e){t.source=t.context.createBufferSource(),t.source.buffer=e,t.source.connect(t.context.destination),t.source.loop=o,t.source.start(a)})}},{key:"stop",value:function(){this.source&&this.source.stop()}}]),e}(),c=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:4;a(this,e),this.totalchannel=t,this.loader=new l,this.channels=[];for(var o=0;o<this.totalchannel;o++)this.channels.push(new s)}return o(e,[{key:"load",value:function(e,t,a){if(i[e])throw new Error("[Audio] Tried to register existing audio file with id "+e);return i[e]=new n,this.loader.loadAudio(t,i[e],a),i[e]}},{key:"play",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=this,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,l=3<arguments.length&&void 0!==arguments[3]&&arguments[3];if(r("Audio","Requested song with id "+e+" to be played"),!i[e])throw new Error("[Audio] Tried to play undefined sound with id "+e);return i[e].ready?void this.channels[t].play(e,o,l):(r("Audio","Song with id "+e+" will play once it's loaded"),i[e].onready=function(){r("Audio","Song with id "+e+" will now play automatically"),a.channels[t].play(e,o,l)},!1)}},{key:"stop",value:function(e){this.channels[e].stop()}}]),e}();t.exports=c},{"./loader":12,"./log":13}],5:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),r=e("./log"),l=e("./physics"),i=function(){function e(t,o,r,i,n){a(this,e),this.rect=new l.Rect(0,0,r,i),this.origin=new l.Vector2D(t,o),this.limits=new l.Vector2D(r,i),this.vmod=n,this.following,this.locked=!1}return o(e,[{key:"lock",value:function(){this.locked=!0}},{key:"unlock",value:function(){this.locked=!1}},{key:"follow",value:function(e){this.following=e}},{key:"resize",value:function(e,t){this.rect.w=e,this.rect.h=t}},{key:"setLimits",value:function(e){this.limits=e}},{key:"updateFromBound",value:function(){var e=this.rect.w/2,t=this.rect.h/2,a=this.following.vector.x-this.rect.x,o=this.following.vector.y-this.rect.y;a>e+this.following.rect.x?this.rect.x+=a-this.following.rect.x-e:a+this.following.rect.x<e&&(this.rect.x-=e-(a+this.following.rect.x)),o>t?this.rect.y+=o-t:o+this.following.rect.y<t&&(this.rect.y-=t-(o+this.following.rect.y)),0>this.rect.x?this.rect.x=0:this.rect.x+this.rect.w>this.limits.x&&(this.rect.x=this.limits.x-this.rect.w),0<this.rect.y?this.rect.y=0:this.rect.y-this.rect.h<-this.limits.y&&(this.rect.y=-(this.limits.y-this.rect.h))}},{key:"update",value:function(){this.following&&this.updateFromBound()}}]),e}();t.exports=i},{"./log":13,"./physics":15}],6:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),r=e("./log"),l=e("./dom"),i=e("./glob"),n=function(){function e(t){a(this,e),this.pingcount=0,this.init=!1,this.canvas=t}return o(e,[{key:"createElem",value:function(){this.elem=l.create({node:"div",id:"gamedebugger",parent:document.body,children:[{node:"div",id:"debugframecount"},{node:"div",id:"debugfps"}]}),this.outputelem=l.create({node:"div",id:"debugoutput",parent:this.elem}),this.init=!0}},{key:"bindError",value:function(){var t=this;i.onerror=function(o,a,r,l,i){return t.error(o,a,r,l,i)}}},{key:"addStylesheet",value:function(){l.create({node:"link",attr:{rel:"stylesheet",href:"/debug.css"},parent:document.head})}},{key:"report",value:function(){}},{key:"ping",value:function(){this.pingcount++,this.init&&(l.byID("debugframecount").textContent=this.pingcount+" frames")}},{key:"startFPS",value:function(){var e=this;this.lastpingat=0;setTimeout(function t(){l.byID("debugfps").textContent=e.pingcount-e.lastpingat+" FPS",e.lastpingat=e.pingcount,setTimeout(t,1e3)},1e3)}},{key:"log",value:function(e,t){l.create({node:"div",text:"["+new Date().toLocaleTimeString()+" - "+e+"] - "+t,parent:this.outputelem}),this.elem.scrollTop=this.outputelem.scrollHeight}},{key:"bindCanvasEvents",value:function(){}},{key:"cast",value:function(){var e=this;this.createElem(),this.addStylesheet(),this.bindError(),this.bindCanvasEvents(),this.startFPS(),r.listen(function(t,a){return e.log(t,a)}),r("Debugger","Created debugger"),this.elem.classList.add("shown")}},{key:"error",value:function(e,t,a,o,r){l.create({node:"div",text:e,attr:{style:"color : red;"},parent:this.outputelem}),l.create({node:"pre",html:r&&r.stack,attr:{style:"color : red;"},parent:this.outputelem})}}]),e}();t.exports=n},{"./dom":7,"./glob":9,"./log":13}],7:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),r=function(){function e(){a(this,e)}return o(e,[{key:"create",value:function(e){if("text"==e.node)return document.createTextNode(e.text);var t=document.createElement(e.node);if(e.id&&(t.id=e.id),t.className=e.className||e.classList&&e.classList.join(" ")||"",e.attr)for(var a=Object.keys(e.attr),o=0;o<a.length;o++)t.setAttribute(a[o],e.attr[a[o]]);if(e.text?t.textContent=e.text:e.html&&(t.innerHTML=e.html),e.children)for(var o=0;o<e.children.length;o++)t.appendChild(this.create(e.children[o]));return e.parent&&e.parent.appendChild(t),t}},{key:"byID",value:function(e){return document.getElementById(e)}},{key:"query",value:function(e,t){return document[t?"querySelectorAll":"querySelector"](e)}}]),e}();t.exports=new r},{}],8:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=Math.abs,r=function(){function e(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),l=e("./log"),i=e("./dom"),n=e("./physics"),s=e("./keyboard"),c=e("./sprite"),d=e("./spriteset"),y=e("./area"),u={},p=["right","top","left","top","left","bottom","right","bottom"],g=function(){function e(t,o){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};switch(a(this,e),this.game=t,this.type=o,this.options=Object.assign(e.defaultoptions(),r),this.vector=new n.Vector2D(this.options.x,this.options.y),this.rect=new n.Vector2D(this.options.w,this.options.h),this.collision=this.options.collision||new n.Rect(0,0,this.rect.x,this.rect.y),this.strength=this.options.strength,this.effects=Object.assign(e.defaulteffects(),i),this.sticked=!1,this.vector.setMaxVelocity(this.options.maxspeed,this.options.maxgravity),this.controlled=this.options.controlled,this.options.gravity&&this.applyGravity(this.options.gravity),this.type){case"image":this.initImage();break;case"sprite":this.initSprite();break;case"area":this.initArea();break;case"shape":this.initShape(r);break;default:throw new Error("GElement was created without an invalid type : "+this.type);}l("GElement","Created a new Graphic Element of type "+this.type)}return r(e,null,[{key:"defaultoptions",value:function(){return{x:0,y:0,w:0,h:0,useimagesize:!1,initspeed:1,maxspeed:3,friction:0.2,gravity:0,maxgravity:0,jumpheight:0,strength:500,controlled:!1,fixedtostage:!1,pattern:!1,patternsize:void 0,override:{}}}},{key:"defaulteffects",value:function(){return{opacity:1}}},{key:"createTemplate",value:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},r=arguments[4];if(!r&&u[e])throw new Error("[GraphicElement] Template with id "+e+" already exists");u[e]={type:t,options:a,effects:o}}},{key:"fromTemplate",value:function(t,a){var o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},l=u[a];if(!l)throw new Error("[GraphicElement] Tried to initialize with undefined template : "+a);return new e(t,l.type,Object.assign(l.options,o),Object.assign(l.effects,r))}}]),r(e,[{key:"setPosition",value:function(e,t){this.vector.at(e,t)}},{key:"initSprite",value:function(){this.drawable=this.options.sprite}},{key:"initImage",value:function(){this.url=this.options.url,this.drawable=new c({spritesets:{neutral:new d("file",this.url)},useimagesize:this.options.useimagesize}),this.options.pattern&&this.drawable.createPattern(this.game.context,this.options.patternsize),l("GElement","Initialized Graphic Element with image at "+this.url)}},{key:"initArea",value:function(){this.drawable=new y,l("Gelement","Initialized Graphic Element with an area")}},{key:"applyGravity",value:function(e){this.vector.setAcceleration(this.vector.accelx,e)}},{key:"initShape",value:function(){}},{key:"isOnFloor",value:function(){return this.sticked}},{key:"update",value:function(){return this.vector.update(),this.options.gravity&&this.vector.y+this.rect.y>this.game.height&&(this.vector.y=this.game.height-this.rect.y,this.vector.vely=0,this.sticked=!0),this}},{key:"updateState",value:function(){0>this.vector.vely?(this.drawable.changeState("jumping"),this.sticked=!1):0<this.vector.vely?(this.drawable.changeState("falling"),this.sticked=!1):0==this.vector.velx?this.drawable.changeState("neutral"):this.drawable.changeState("running")}},{key:"on",value:function(e,t){this.drawable.on(e,t)}},{key:"shouldBeDrawn",value:function(e){return 0<this.vector.x-e.rect.x+this.rect.x&&this.vector.x-e.rect.x<e.rect.w&&0<this.vector.y-e.rect.y+this.rect.y&&this.vector.y-e.rect.y<e.rect.h}},{key:"restrict",value:function(e,t){0>this.vector.x+this.collision.x?(this.vector.x=-this.collision.x,this.vector.velx=0,this.vector.accelx=0):this.vector.x+this.collision.x+this.collision.w>t.x&&(this.vector.x=t.x-this.collision.x-this.collision.w,this.vector.velx=0,this.vector.accelx=0),-(this.vector.y+this.collision.y)>t.y-e.rect.h&&(this.vector.y=-(t.y-e.rect.h)-this.collision.y,this.vector.vely=0)}},{key:"collide",value:function(e,t){if(this.strength<=t.strength){for(var a=this.collisionPoints,r=t.collisionPoints,l=[a[0][0]-r[2][0],a[0][1]-r[2][1],a[1][0]-r[3][0],a[1][1]-r[3][1],a[2][0]-r[0][0],a[2][1]-r[0][1],a[3][0]-r[1][0],a[3][1]-r[1][1]],n=0,s=l[n],c=1;c<l.length;c++)o(l[c])<s&&(n=c,s=o(l[c]));this.drawable.collide(t,p[n])&&(0==n%2?(this.vector.velx=0,this.vector.accelx=0,this.vector.x-=l[n]):(0<this.vector.vely&&(this.sticked=!0),this.vector.vely=0,this.vector.y-=l[n]))}}},{key:"collisionBox",value:function(e){return new n.Rect(this.vector.x-e.rect.x+this.collision.x,this.vector.y-e.rect.y+this.collision.y,this.collision.w,this.collision.h)}},{key:"debug",value:function(e,t,a){var o={x:this.vector.x-t.rect.x,y:this.vector.y-t.rect.y,w:this.rect.x,h:this.rect.y};a&&(e.beginPath(),e.rect(this.collision.x+o.x,this.collision.y+o.y,this.collision.w||o.w,this.collision.h||o.h),e.lineWidth=1,e.strokeStyle="red",e.stroke(),e.beginPath(),e.rect(o.x,o.y,o.w,o.h),e.lineWidth=1,e.strokeStyle="blue",e.stroke()),e.font="12px Arial, sans-serif",e.fillStyle="black",e.fillText("Relative "+this.vector.x+" x "+this.vector.y,o.x+o.w+5,o.y+10),e.fillText("Real "+(this.vector.x-t.rect.x)+" x "+(this.vector.y-t.rect.y),o.x+o.w+5,o.y+24),e.fillText("Velocity "+this.vector.velx+" x "+this.vector.vely,o.x+o.w+5,o.y+38),e.fillText("Acceleration "+this.vector.accelx+" x "+this.vector.accely,o.x+o.w+5,o.y+52),e.fillText("State : "+this.drawable.state+(this.controlled?", controlled":""),o.x+o.w+5,o.y+66),e.fillText("Drawn : "+(a?"Yes":"No"),o.x+o.w+5,o.y+80)}},{key:"draw",value:function(e,t){var a=!1;if(this.shouldBeDrawn(t)){e.globalAlpha=this.effects.opacity;var o=this.drawable.draw(e,t.origin.x+this.vector.x-t.rect.x,t.origin.y+this.vector.y-t.rect.y,this.rect.x,this.rect.y);e.globalAlpha=1,a=!!o,this.options.useimagesize&&o&&(this.rect.x=o.w,this.rect.y=o.h)}return this.game.dev&&this.debug(e,t,a),a}},{key:"override",value:function(e,t){this.override[e]=t}},{key:"jump",value:function(){this.isOnFloor()&&(this.sticked=!1,this.override.jump?this.override.jump():this.vector.vely=-this.options.jumpheight)}},{key:"keyCommand",value:function(e,t){if(t)switch(e){case s.KEY_RIGHT:this.direction="right",this.keydown=!0,this.vector.setAcceleration(this.options.friction,this.vector.accely),this.drawable.changeState(this.drawable.state,"right");break;case s.KEY_LEFT:this.direction="left",this.keydown=!0,this.vector.setAcceleration(-this.options.friction,this.vector.accely),this.drawable.changeState(this.drawable.state,"left");break;case s.KEY_SPACE:case s.KEY_UP:this.jump();break;default:}else if(this.keydown&&(e==s.KEY_LEFT||e==s.KEY_RIGHT)){this.keydown=!1;var a="left"==this.direction?1:-1;-1==a&&0<this.vector.velx||1==a&&0>this.vector.velx?this.vector.setAcceleration(this.options.friction*a,this.vector.accely,!0):0!=this.vector.velx&&this.vector.setAcceleration(this.options.friction*-a,this.vector.accely,!0),this.drawable.changeState()}}},{key:"control",value:function(e){var t=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.controlled=!0,this.keyboard=e,l("GElement","Binding Graphic Element with keyboard controls"),a.arrows&&(this.keventleft=function(e,a,o){return t.keyCommand(e,a,o)},this.keventright=function(e,a,o){return t.keyCommand(e,a,o)},this.keventup=function(e,a,o){return t.keyCommand(e,a,o)},this.keventspace=function(e,a,o){return t.keyCommand(e,a,o)},e.bindKey("left",this.keventleft),e.bindKey("right",this.keventright),e.bindKey("up",this.keventup),e.bindKey("space",this.keventspace))}},{key:"giveupControl",value:function(){keyboard.killKey("left",this.keventleft),keyboard.killKey("right",this.keventright),keyboard.killKey("up",this.keventup),keyboard.killKey("space",this.keventspace)}},{key:"destroy",value:function(){l("GElement","Destroyed Graphic Element of type "+this.type),this.imagebitmap&&this.imagebitmap.close(),this.image&&this.image.remove(),this.controlled&&this.giveupControl()}},{key:"ready",get:function(){return this.drawable.currentState.ready}},{key:"collisionPoints",get:function(){return[[this.vector.x+this.collision.x+this.collision.w,this.vector.y+this.collision.y],[this.vector.x+this.collision.x,this.vector.y+this.collision.y],[this.vector.x+this.collision.x,this.vector.y+this.collision.y+this.collision.h],[this.vector.x+this.collision.x+this.collision.w,this.vector.y+this.collision.y+this.collision.h]]}}]),e}();t.exports=g},{"./area":3,"./dom":7,"./keyboard":11,"./log":13,"./physics":15,"./sprite":16,"./spriteset":17}],9:[function(e,t){(function(e){"use strict";var a=window;a.__SIDESCROLLGAME={env:"dev"},t.exports=a}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{}],10:[function(e,t){"use strict";function a(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),l=e("./log"),n=e("./camera"),s=e("./physics"),c=function(){function e(t,a){o(this,e),this.index=t,this.size=a,this.graphicselements=[],this._assocGE={}}return r(e,[{key:"addElement",value:function(e,t){return l("GraphicLayer","Added an element to layer "+this.index+" with id "+e),this.graphicselements.push(t),this._assocGE[e]=t,this}},{key:"clear",value:function(){return this.graphicselements.forEach(function(e){return e.destroy()}),this.graphicselements=[],this._assocGE={},this}},{key:"impactCheck",value:function(e,t){for(var a=0;a<this.graphicselements.length;a++){this.graphicselements[a].options.fixedtostage&&this.graphicselements[a].restrict(t,this.size);for(var o=a+1;o<this.graphicselements.length;o++)s.Collider.rectangles(this.graphicselements[a].collisionBox(t),this.graphicselements[o].collisionBox(t))&&(this.graphicselements[a].collide(e,this.graphicselements[o]),this.graphicselements[o].collide(e,this.graphicselements[a]))}return this}},{key:"updateStates",value:function(){return this.graphicselements.forEach(function(e){return e.updateState()}),this}},{key:"update",value:function(){return this.graphicselements.forEach(function(e){return e.update()}),this}},{key:"draw",value:function(e,t){return this.graphicselements.forEach(function(a){return a.draw(e,t)}),this}}]),e}(),i=function(){function e(t){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2];o(this,e),this.context=this.c=t,this.options=Object.assign(e.defaultOptions(),a),this.size=r,this.camera=new n(a.origin.x,a.origin.y,t.width,t.height,a.verticalModifier),this.camera.setLimits(this.size),this.layers=[],this.fixedLayer=new c(-1,r);for(var l=0;l<a.layers;l++)this.layers.push(new c(l,r))}return r(e,null,[{key:"defaultOptions",value:function(){return{bgcolor:"#eaeff2"}}}]),r(e,[{key:"resize",value:function(e,t){this.w=e,this.h=t,this.rect=[0,0,this.w,this.h],this.camera.resize(this.w,this.h)}},{key:"clear",value:function(){var e;this.c.fillStyle=this.options.bgcolor,(e=this.c).fillRect.apply(e,a(this.rect))}},{key:"addElement",value:function(e,t,a){return a.id=t,this.layers[e].addElement(t,a),a}},{key:"update",value:function(){var e=this;this.camera.update(),this.layers.forEach(function(t){return t.update().impactCheck(e.context,e.camera).updateStates()})}},{key:"draw",value:function(){var e=this;this.layers.forEach(function(t){return t.draw(e.context,e.camera)})}}]),e}();t.exports=i},{"./camera":5,"./log":13,"./physics":15}],11:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),r=e("./log"),l=e("./glob"),i={up:38,down:40,left:37,right:39,space:32,shift:16,enter:13},n={};for(var s in i)n[s]=!1;var c=function(){function e(t){var o=this;a(this,e),this.canvas=t,r("Keyboard","Binding global key events"),this.keyEvents={13:[],16:[],32:[],37:[],38:[],39:[],40:[]},this.upEvents=[],l.addEventListener("keydown",function(e){o.down(e)}),l.addEventListener("keyup",function(e){o.up(e)})}return o(e,null,[{key:"KEY_UP",get:function(){return i.up}},{key:"KEY_DOWN",get:function(){return i.down}},{key:"KEY_LEFT",get:function(){return i.left}},{key:"KEY_RIGHT",get:function(){return i.right}},{key:"KEY_SPACE",get:function(){return i.space}},{key:"KEY_SHIFT",get:function(){return i.shift}},{key:"KEY_ENTER",get:function(){return i.enter}}]),o(e,[{key:"addKey",value:function(e,t){this.keyEvents[e]=t,i[t]=e,n[e]=!1,r("Keyboard","Registered new key "+t+" with byte "+e)}},{key:"down",value:function(e){this.keyEvents[e.which]&&!n[e.which]&&(n[e.which]=!0,this.keyEvents[e.which].forEach(function(t){return t(e.which,!0)}))}},{key:"keyToCode",value:function(e){return i[e]}},{key:"up",value:function(e){var t=this;if(this.keyEvents[e.which]&&n[e.which]){n[e.which]=!1,this.keyEvents[e.which].forEach(function(t){return t(e.which,!1)});var a=function(e){var a=i[e];n[a]&&t.keyEvents[a]&&t.keyEvents[a].forEach(function(e){return e(a,!0,!0)})};for(var o in i)a(o)}}},{key:"bindKey",value:function(e,t,a){r("Keyboard","Bound key with id "+e),this.keyEvents[i[e]||e].push(a?t.bind(a):t)}},{key:"killKey",value:function(e,t){var a=this.keyEvents[i[e]||e],o=a.indexOf(function(e){return e==t});-1!=o&&a.splice(o,1)}}]),e}();t.exports=c},{"./glob":9,"./log":13}],12:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),r=e("./log"),l={},i=function(){function e(){a(this,e)}return o(e,[{key:"request",value:function(e,t,a){if(l[e])return a&&a(l[e]);var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType=t,o.onload=function(){var i=o.response;r("Loader","Loaded data with type "+t+" from URL "+e),l[e]=i,a&&a(i)},o.send()}},{key:"loadStage",value:function(e,t,a){this.request(e,"json",function(e){var o=t.world.createStageFromRaw(t,e);a&&a(o)},!0)}},{key:"loadWorld",value:function(e,t,a){this.request(e,"json",function(e){t.world.appendFromRaw(t,e),a&&a(t.world)},!0)}},{key:"loadAudio",value:function(e,t,a){this.request(e,"arraybuffer",function(e){t.setBuffer(e),t.onready&&t.onready(),a&&a(e)})}}]),e}();t.exports=i},{"./log":13}],13:[function(e,t){"use strict";var a,o=e("./glob.js"),r=function(e,t){console.log("["+new Date+" - "+e+"] "+t),a&&a(e,t)};r.listen=function(e){a=e},t.exports="dev"==o.__SIDESCROLLGAME.env?r:function(){}},{"./glob.js":9}],14:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),r=e("./log"),l=e("./physics"),i=function(){function e(t){a(this,e),this.canvas=t,this.bindBasicEvents(),this.vector,this.bound={mousedown:[],mouseup:[]}}return o(e,[{key:"bindBasicEvents",value:function(){var e=this;this.canvas.addEventListener("mousedown",function(t){var a=1==t.which?"left":3==t.which?"right":"other";e.vector=new l.Vector2D(t.x,t.y),r("Mouse","Mouse down at "+t.x+" x "+t.y+", using "+a+" button"),e.bound.mousedown.forEach(function(e){return e()})}),this.canvas.addEventListener("mouseup",function(t){e.vector.to(t.x,t.y),r("Mouse","Mouse released at "+t.x+" x "+t.y+", distance of "+e.vector.length()+" px"),e.bound.mouseup.forEach(function(e){return e()})})}},{key:"bind",value:function(e,t,a){this.bound[e].push(t.bind(a))}},{key:"directBind",value:function(e,t,a){this.canvas.addEventListener(e,t.bind(a))}}]),e}();t.exports=i},{"./log":13,"./physics":15}],15:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=Math.abs,r=function(){function e(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),l=function(){function e(t,o,r,l){a(this,e),this.x=t,this.y=o,this.destx=r,this.desty=l,this.velx=0,this.vely=0,this.accelx=0,this.accely=0,this.maxvelx,this.maxvely}return r(e,[{key:"add",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"sub",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"at",value:function(e,t){this.x=e,this.y=t}},{key:"to",value:function(e,t){this.destx=e,this.desty=t}},{key:"setMaxVelocity",value:function(e,t){this.maxvelx=e,this.maxvely=t}},{key:"setVelocity",value:function(e,t){this.velx=e,this.vely=t}},{key:"setAcceleration",value:function(e,t,a,o){this.accelx=e,this.accely=t,this.breakatzerox=a,this.breakatzeroy=o}},{key:"update",value:function(){var e=this.velx,t=this.vely;this.velx+=this.accelx,this.vely+=this.accely,this.maxvelx&&o(this.velx)>this.maxvelx&&(this.velx=this.maxvelx*(0>this.velx?-1:1)),this.maxvely&&o(this.vely)>this.maxvely&&(this.vely=this.maxvely*(0>this.vely?-1:1)),this.breakatzerox&&(0<e&&0>=this.velx||0>e&&0<=this.velx)&&(this.accelx=0,this.velx=0),this.breakatzeroy&&(0<t&&0>this.vely||0>t&&0<this.vely)&&(this.accely=0,this.vely=0),this.x+=this.velx,this.y+=this.vely}},{key:"length",value:function(){var e=Math.pow;return Math.sqrt(e(this.x-this.destx,2)+e(this.y-this.desty,2))}}]),e}(),i=function(){function e(t,o,r,l){a(this,e),this.x=t,this.y=o,this.w=r,this.h=l}return r(e,[{key:"points",get:function(){return[[this.x,this.y+this.h],[this.x,this.y],[this.x+this.w,this.y],[this.x+this.w,this.y+this.h]]}}],[{key:"fromVectors2D",value:function(t,a){return new e(t.x,t.y,a.x,a.y)}},{key:"Points",value:function(t,a,o,r){return new e(t,a,o,r).points}}]),e}(),n=function(){function e(){a(this,e)}return r(e,null,[{key:"rectangles",value:function(e,t){return!(e.y+e.h<=t.y||e.y>=t.y+t.h||e.x+e.w<=t.x||e.x>=t.x+t.w)}},{key:"vectors",value:function(){}},{key:"vect2rect",value:function(){}}]),e}();t.exports={Vector2D:l,Rect:i,Collider:n}},{}],16:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(){function e(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),i=e("./log"),n=e("./physics"),s=e("./abstract/drawable"),c=function(e){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};a(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));for(var l in r.options=e,r.state=e.state||"neutral",r.facing=e.facing||"right",r.initialstate=r.state,r.pattern=e.pattern,r.spritesets={},e.spritesets||{})r.addState(l,e.spritesets[l]);return r}return r(t,e),l(t,[{key:"createPattern",value:function(e,t){for(var a in this.pattern=!0,this.spritesets)this.spritesets[a].createPattern(e,t)}},{key:"addState",value:function(e,t){this.spritesets[e]=t}},{key:"changeState",value:function(e,t){var a=this.state;this.state=e||this.initialstate,this.facing=t||this.facing,this.currentState||(this.spritesets[this.state]=this.spritesets.neutral),a!=this.state&&this.currentState.resetFrame()}},{key:"updateState",value:function(){this.currentState.nextFrame()}},{key:"draw",value:function(e,t,a,o,r){var l;return e.save(),"right"==this.facing?this.useimagesize?l=this.currentState.draw(e,t,a):l=this.currentState.draw(e,t,a,o,r):"left"==this.facing&&(e.scale(-1,1),l=this.useimagesize?this.currentState.draw(e,-t-o,a):this.currentState.draw(e,-t-o,a,o,r),l.x=t),e.restore(),l}},{key:"currentState",get:function(){return this.spritesets[this.state]}}]),t}(s);t.exports=c},{"./abstract/drawable":2,"./log":13,"./physics":15}],17:[function(e,t){"use strict";function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=function(){function e(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),i=e("./log"),n=e("./physics"),s=e("./dom"),c=e("./abstract/drawable"),d=function(e){function t(e,o,l,n,s){r(this,t);var c=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(c.type=e,c.url=o,c.frame=0,c.framestateupdate=n||!1,c.drew=0,c.ready=!1,c.totalstates=l||1,c.noloop=s,c.states=[],c.patterns=[],c.pattern=!1,i("SpriteSet","Creating new Sprite Set from "+c.url+" with "+c.totalstates+" states"),"singleimage"===e);else if("file"===e)c.load();else if("fileset"===e)c.load();else throw new Error("Created a SpriteSet with an invalid type : "+e);return c}return o(t,e),l(t,[{key:"getImageFromURL",value:function(e,t){var a=new Image;a.onload=function(){createImageBitmap(a).then(function(e){t(e)})},a.src=e}},{key:"resetFrame",value:function(){this.frame=0}},{key:"previousFrame",value:function(){this.frame--,0>this.frame&&(this.frame=this.totalstates-1)}},{key:"nextFrame",value:function(){this.frame++,this.frame==this.totalstates&&(this.frame=this.noloop?this.frame-1:0)}},{key:"load",value:function(e){var t=this;if("singleimage"==this.type);else{i("SpriteSet","Loading states from url scheme "+this.url);var a=-1,o=function o(){return++a==t.totalstates?(t.onready&&t.onready(),t.ready=!0,i("SpriteSet","Done loading states for SpriteSet with url "+t.url),e&&e()):void t.getImageFromURL(t.url.replace("$",a+1),function(e){t.states.push(e),o()})};o()}}},{key:"createPattern",value:function(e,t){var a=this;this.pattern=!0;var o=function(){a.states.forEach(function(o){var r=s.create({node:"canvas"});t||(t=new n.Vector2D(o.width,o.height)),r.width=t.x,r.height=t.y,r.getContext("2d").drawImage(o,0,0,t.x,t.y),a.patterns.push({pattern:e.createPattern(r,"repeat"),canvas:r})}),i("SpriteSet","Loaded pattern for "+a.states.length+" states")};this.ready?o():this.onready=o}},{key:"draw",value:function(e,t,a,o,r){if(this.ready)return t=t||0,a=a||0,o=o||this.currentFrame.width,r=r||this.currentFrame.height,this.pattern?(e.fillStyle=this.currentPattern.pattern,e.fillRect(t,a,o,r)):e.drawImage(this.currentFrame,t,a,o,r),this.drew++,this.framestateupdate&&this.drew==this.framestateupdate&&(this.drew=0,this.nextFrame()),new n.Rect(t,a,o,r)}},{key:"destroy",value:function(){this.patterns.forEach(function(e){e.canvas.remove(),e.pattern=void 0})}},{key:"currentFrame",get:function(){return this.states[this.frame]}},{key:"currentPattern",get:function(){return this.patterns[this.frame]}}]),t}(c);t.exports=d},{"./abstract/drawable":2,"./dom":7,"./log":13,"./physics":15}],18:[function(e,t){"use strict";function a(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var a,o=0;o<t.length;o++)a=t[o],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),l=e("./log"),i=e("./glob"),n=e("./physics"),s=e("./graphics"),c=e("./gelement"),d=e("./sprite"),y=e("./spriteset"),u=function(){function e(t){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};o(this,e),this.context=t.context,this.audio=t.audio,this.stages=a,this.currentStage}return r(e,[{key:"createStage",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=arguments[2],o=arguments[3];if(!a&&this.stages[e])throw new Error("[World] Stage with id "+e+" already exists");var r=new p(e,this.context,t);return this.stages[e]=r,r.fire("added"),o&&this.switchStage(e),r}},{key:"appendFromRaw",value:function(e,t){var a=this;l("World","Adding to World object from raw JSON data"),t.stages&&t.stages.forEach(function(t){a.createStageFromRaw(e,t)})}},{key:"createStageFromRaw",value:function(e,t){l("Stage","Building Stage object from raw JSON data"),t.options&&t.options.size&&(t.options.size=new(Function.prototype.bind.apply(n.Vector2D,[null].concat(a(t.options.size)))));var o=this.createStage(t.id,t.options);return t.resources&&t.resources.forEach(function(t){switch(t.type){case"audio":e.audio.load(t.id,t.url);}}),t.templates&&t.templates.forEach(function(e){c.createTemplate(e.id,e.type,e.options,e.filters)}),t.elements&&t.elements.forEach(function(t){var r;if(t.options&&t.options.sprite){var l={};if(t.options.sprite.spritesets)for(var s in t.options.sprite.spritesets)l[s]=new(Function.prototype.bind.apply(y,[null].concat(a(t.options.sprite.spritesets[s]))));t.options.sprite=new d({spritesets:l})}if(t.options&&t.options.collision&&(t.options.collision=new(Function.prototype.bind.apply(n.Rect,[null].concat(a(t.options.collision))))),r=t.template?o.addElement(t.layer,t.id,c.fromTemplate(e,t.template,t.options)):o.addElement(t.layer,t.id,new c(e,t.type,t.options)),t.on)for(var u in t.on)r.on(u,i[t.on[u]]);t.controlled&&r.control(e.keyboard,{arrows:!0}),t.followed&&o.follow(r)}),o}},{key:"switchStage",value:function(e){if(l("World","Switching to stage with id "+e),!this.stages[e])throw new Error("[World] Stage with id "+e+" does not exist");this.currentStage&&this.currentStage.fire("switchout"),this.currentStage=this.stages[e],this.currentStage.options.song&&this.audio.play(this.currentStage.options.song,0,0,!0),this.currentStage.fire("switchin")}},{key:"resize",value:function(e,t){for(var a in this.stages)this.stages[a].graphics.resize(e,t)}},{key:"update",value:function(){this.stage.update()}},{key:"draw",value:function(){this.stage.draw()}},{key:"hasStage",value:function(){return!!this.currentStage}},{key:"stage",get:function(){return this.currentStage}}]),e}(),p=function(){function e(t,a){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};o(this,e),this.id=t,this.options=Object.assign(e.defaultOptions(),r),this.context=a,l("Stage","Created Stage with size : "+this.options.size),this.graphics=new s(this.context,this.options,this.options.size)}return r(e,null,[{key:"defaultOptions",value:function(){return{size:new n.Vector2D(1920,1080),origin:new n.Vector2D(0,0),verticalModifier:1,song:void 0,hooks:{},layers:5}}}]),r(e,[{key:"fire",value:function(e,t){var a=this.options.hooks[e];a&&a(t)}},{key:"on",value:function(e,t){this.hooks[e]=t}},{key:"update",value:function(){this.graphics.update()}},{key:"draw",value:function(){this.graphics.clear(),this.graphics.draw()}},{key:"addElement",value:function(){var e;return(e=this.graphics).addElement.apply(e,arguments)}},{key:"follow",value:function(){var e;return(e=this.graphics.camera).follow.apply(e,arguments)}}]),e}();t.exports=u},{"./gelement":8,"./glob":9,"./graphics":10,"./log":13,"./physics":15,"./sprite":16,"./spriteset":17}]},{},[1]);
