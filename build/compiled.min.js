(function c(y,e,t){function a(i,o){if(!e[i]){if(!y[i]){var n="function"==typeof require&&require;if(!o&&n)return n(i,!0);if(r)return r(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var d=e[i]={exports:{}};y[i][0].call(d.exports,function(t){var e=y[i][1][t];return a(e?e:t)},d,d.exports,c,y,e,t)}return e[i].exports}for(var r="function"==typeof require&&require,l=0;l<t.length;l++)a(t[l]);return a})({1:[function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),r=e("./lib/glob"),l=e("./lib/log"),i=e("./lib/debugger"),o=e("./lib/mouse"),n=e("./lib/graphics"),s=e("./lib/spriteset"),c=e("./lib/sprite"),y=e("./lib/gelement"),d=e("./lib/physics"),u=e("./lib/keyboard"),p=e("./lib/world"),v=e("./lib/audio"),g=function(){function e(a){var l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(t(this,e),this.canvas="string"==typeof a?document.getElementById(a):a,!this.canvas)throw new Error("Undefined canvas ID");this.context=this.c=this.canvas.getContext("2d"),this.options=Object.assign(e.defaults(),l),this.gamedebugger=new i(this.canvas),this.mouse=new o(this.canvas),this.keyboard=new u(this.canvas),this.audio=new v(this.options.audiochannels),this.world=new p(this,this.options.world),"dev"===this.options.env&&(this.dev=!0,this.gamedebugger.cast()),this.timing={delta:0,ctime:0,frame:0,framerate:1e3/this.options.fps},this.width=this.options.width||this.canvas.style.width||this.canvas.width||r.innerWidth,this.height=this.options.height||this.canvas.style.height||this.canvas.height||r.innerHeight,this.bindResize(),this.resize()}return a(e,null,[{key:"defaults",value:function(){return{bgcolor:"#eaeff2",fps:60,env:"prod"}}}]),a(e,[{key:"resize",value:function(){var e=this.width,t=this.height;this.canvas.width=e,this.canvas.height=t,this.world.resize(e,t),l("Game","Handled resized at "+e+" x "+t)}},{key:"bindResize",value:function(){var e=this;r.addEventListener("resize",function(){return e.resize()})}},{key:"start",value:function(){var e=this;if(l("Game","Starting engine"),!this.world.hasStage())throw new Error("[Game] Cannot start game without a stage");return this.resize(),this.frameRequest=requestAnimationFrame(function(t){e.draw(t)}),this}},{key:"update",value:function(){return this.gamedebugger.ping(),this.world.update(),this}},{key:"draw",value:function(e){var t=this,a=this.timing.ctime-e;return a<this.timing.framerate&&(this.timing.ctime=e,this.timing.frame++,this.update(),this.world.draw()),this.frameRequest=requestAnimationFrame(function(e){t.draw(e)}),this}},{key:"createStage",value:function(){var e;return(e=this.world).createStage.apply(e,arguments)}}]),e}();r.SideQuest={Game:g,SpriteSet:s,Sprite:c,GraphicElement:y,Physics:d,Keyboard:u,Mouse:o,World:p,Audio:v,log:l}},{"./lib/audio":2,"./lib/debugger":4,"./lib/gelement":6,"./lib/glob":7,"./lib/graphics":8,"./lib/keyboard":9,"./lib/log":10,"./lib/mouse":11,"./lib/physics":12,"./lib/sprite":13,"./lib/spriteset":14,"./lib/world":15}],2:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),l=e("./log"),i={},o=function(){function e(){a(this,e),this.ready=!1}return r(e,[{key:"setBuffer",value:function(e){this.buffer=e,this.ready=!0}}]),e}(),n=function(){function e(){a(this,e),this.context=new AudioContext,this.source}return r(e,[{key:"play",value:function(e){var t=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=arguments[2];this.context.decodeAudioData(i[e].buffer,function(e){t.source=t.context.createBufferSource(),t.source.buffer=e,t.source.connect(t.context.destination),t.source.loop=r,t.source.start(a)})}},{key:"stop",value:function(){this.source&&this.source.stop()}}]),e}(),s=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:4;a(this,e),this.totalchannel=t,this.channels=[];for(var r=0;r<this.totalchannel;r++)this.channels.push(new n)}return r(e,[{key:"load",value:function(e,t,a){if(i[e])throw new Error("[Audio] Tried to register existing audio file with id "+e);i[e]=new o;var r=new XMLHttpRequest;return r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){i[e].setBuffer(r.response),i[e].onready&&i[e].onready(),a&&a()},r.send(),i[e]}},{key:"play",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,o=3<arguments.length&&void 0!==arguments[3]&&arguments[3];if(l("Audio","Requested song with id "+e+" to be played"),!i[e])throw new Error("[Audio] Tried to play undefined sound with id "+e);return i[e].ready?void this.channels[t].play(e,r,o):(l("Audio","Song with id "+e+" will play once it' loaded"),i[e].onready=function(){a.channels[t].play(e,r,o)},!1)}},{key:"stop",value:function(e){this.channels[e].stop()}}]),e}();t.exports=s},{"./log":10}],3:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),l=e("./log"),i=e("./physics"),o=function(){function e(t,r,l,o,n){a(this,e),this.rect=new i.Rect(0,0,l,o),this.origin=new i.Vector2D(t,r),this.limits=new i.Vector2D(l,o),this.vmod=n,this.following,this.locked=!1}return r(e,[{key:"lock",value:function(){this.locked=!0}},{key:"unlock",value:function(){this.locked=!1}},{key:"follow",value:function(e){this.following=e}},{key:"resize",value:function(e,t){this.rect.w=e,this.rect.h=t}},{key:"setLimits",value:function(e){this.limits=e}},{key:"updateFromBound",value:function(){var e=this.rect.w/2,t=this.rect.h/2,a=this.following.vector.x-this.rect.x,r=this.following.vector.y-this.rect.y;a>e+this.following.rect.x?this.rect.x+=a-this.following.rect.x-e:a+this.following.rect.x<e&&(this.rect.x-=e-(a+this.following.rect.x)),r>t?this.rect.y+=r-t:r+this.following.rect.y<t&&(this.rect.y-=t-(r+this.following.rect.y)),0>this.rect.x?this.rect.x=0:this.rect.x+this.rect.w>this.limits.x&&(this.rect.x=this.limits.x-this.rect.w),0<this.rect.y?this.rect.y=0:this.rect.y-this.rect.h<-this.limits.y&&(this.rect.y=-(this.limits.y-this.rect.h))}},{key:"update",value:function(){this.following&&this.updateFromBound()}}]),e}();t.exports=o},{"./log":10,"./physics":12}],4:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),l=e("./log"),i=e("./dom"),o=e("./glob"),n=function(){function e(t){a(this,e),this.pingcount=0,this.init=!1,this.canvas=t}return r(e,[{key:"createElem",value:function(){this.elem=i.create({node:"div",id:"gamedebugger",parent:document.body,children:[{node:"div",id:"debugframecount"},{node:"div",id:"debugfps"}]}),this.outputelem=i.create({node:"div",id:"debugoutput",parent:this.elem}),this.init=!0}},{key:"bindError",value:function(){var t=this;o.onerror=function(r,a,l,i,o){return t.error(r,a,l,i,o)}}},{key:"addStylesheet",value:function(){i.create({node:"link",attr:{rel:"stylesheet",href:"/debug.css"},parent:document.head})}},{key:"report",value:function(){}},{key:"ping",value:function(){this.pingcount++,this.init&&(i.byID("debugframecount").textContent=this.pingcount+" frames")}},{key:"startFPS",value:function(){var e=this;this.lastpingat=0;setTimeout(function t(){i.byID("debugfps").textContent=e.pingcount-e.lastpingat+" FPS",e.lastpingat=e.pingcount,setTimeout(t,1e3)},1e3)}},{key:"log",value:function(e,t){i.create({node:"div",text:"["+new Date().toLocaleTimeString()+" - "+e+"] - "+t,parent:this.outputelem}),this.elem.scrollTop=this.outputelem.scrollHeight}},{key:"bindCanvasEvents",value:function(){}},{key:"cast",value:function(){var e=this;this.createElem(),this.addStylesheet(),this.bindError(),this.bindCanvasEvents(),this.startFPS(),l.listen(function(t,a){return e.log(t,a)}),l("Debugger","Created debugger"),this.elem.classList.add("shown")}},{key:"error",value:function(e,t,a,r,l){i.create({node:"div",text:e,attr:{style:"color : red;"},parent:this.outputelem}),i.create({node:"pre",html:l&&l.stack,attr:{style:"color : red;"},parent:this.outputelem})}}]),e}();t.exports=n},{"./dom":5,"./glob":7,"./log":10}],5:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),l=function(){function e(){a(this,e)}return r(e,[{key:"create",value:function(e){if("text"==e.node)return document.createTextNode(e.text);var t=document.createElement(e.node);if(e.id&&(t.id=e.id),t.className=e.className||e.classList&&e.classList.join(" ")||"",e.attr)for(var a=Object.keys(e.attr),r=0;r<a.length;r++)t.setAttribute(a[r],e.attr[a[r]]);if(e.text?t.textContent=e.text:e.html&&(t.innerHTML=e.html),e.children)for(var r=0;r<e.children.length;r++)t.appendChild(this.create(e.children[r]));return e.parent&&e.parent.appendChild(t),t}},{key:"byID",value:function(e){return document.getElementById(e)}},{key:"query",value:function(e,t){return document[t?"querySelectorAll":"querySelector"](e)}}]),e}();t.exports=new l},{}],6:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=Math.abs,l=function(){function e(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),i=e("./log"),o=e("./dom"),n=e("./physics"),s=e("./keyboard"),c=e("./sprite"),y=e("./spriteset"),d={},u=function(){function e(t,r){var l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};switch(a(this,e),this.game=t,this.type=r,this.options=Object.assign(e.defaultoptions(),l),this.vector=new n.Vector2D(this.options.x,this.options.y),this.rect=new n.Vector2D(this.options.w,this.options.h),this.collision=this.options.collision||new n.Rect(0,0,this.rect.x,this.rect.y),this.strength=this.options.strength,this.effects=Object.assign(e.defaulteffects(),o),this.sticked=!1,this.vector.setMaxVelocity(this.options.maxspeed,this.options.maxgravity),this.controlled=this.options.controlled,this.options.gravity&&this.applyGravity(this.options.gravity),this.type){case"image":this.initImage();break;case"sprite":this.initSprite();break;case"shape":this.initShape(l);break;default:throw new Error("GElement was created without an invalid type : "+this.type);}i("GElement","Created a new Graphic Element of type "+this.type)}return l(e,null,[{key:"defaultoptions",value:function(){return{x:0,y:0,w:0,h:0,useimagesize:!1,initspeed:1,maxspeed:3,friction:0.2,gravity:0,maxgravity:0,jumpheight:0,strength:500,controlled:!1,fixedtostage:!1,pattern:!1,patternsize:void 0,override:{}}}},{key:"defaulteffects",value:function(){return{opacity:1}}},{key:"createTemplate",value:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},l=arguments[4];if(!l&&d[e])throw new Error("[GraphicElement] Template with id "+e+" already exists");d[e]={type:t,options:a,effects:r}}},{key:"fromTemplate",value:function(t,a){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=d[a];if(!i)throw new Error("[GraphicElement] Tried to initialize with undefined template : "+a);return new e(t,i.type,Object.assign(i.options,r),Object.assign(i.effects,l))}}]),l(e,[{key:"setPosition",value:function(e,t){this.vector.at(e,t)}},{key:"initSprite",value:function(){this.sprite=this.options.sprite}},{key:"initImage",value:function(){this.url=this.options.url,this.sprite=new c({spritesets:{neutral:new y("file",this.url)},useimagesize:this.options.useimagesize}),this.options.pattern&&this.sprite.createPattern(this.game.context,this.options.patternsize),i("GElement","Initialized Graphic Element with image at "+this.url)}},{key:"applyGravity",value:function(e){this.vector.setAcceleration(this.vector.accelx,e)}},{key:"initShape",value:function(){}},{key:"isOnFloor",value:function(){return this.sticked}},{key:"update",value:function(){return this.vector.update(),this.options.gravity&&this.vector.y+this.rect.y>this.game.height&&(this.vector.y=this.game.height-this.rect.y,this.vector.vely=0,this.sticked=!0),this}},{key:"updateState",value:function(){0>this.vector.vely?(this.sprite.changeState("jumping"),this.sticked=!1):0<this.vector.vely?(this.sprite.changeState("falling"),this.sticked=!1):0==this.vector.velx?this.sprite.changeState("neutral"):this.sprite.changeState("running")}},{key:"shouldBeDrawn",value:function(e){return 0<this.vector.x-e.rect.x+this.rect.x&&this.vector.x-e.rect.x<e.rect.w&&0<this.vector.y-e.rect.y+this.rect.y&&this.vector.y-e.rect.y<e.rect.h}},{key:"restrict",value:function(e,t){0>this.vector.x+this.collision.x?(this.vector.x=-this.collision.x,this.vector.velx=0,this.vector.accelx=0):this.vector.x+this.collision.x+this.collision.w>t.x&&(this.vector.x=t.x-this.collision.x-this.collision.w,this.vector.velx=0,this.vector.accelx=0),-(this.vector.y+this.collision.y)>t.y-e.rect.h&&(this.vector.y=-(t.y-e.rect.h)-this.collision.y,this.vector.vely=0)}},{key:"collide",value:function(e,t){if(this.strength<=t.strength){for(var a=this.collisionPoints,l=t.collisionPoints,o=[a[0][0]-l[2][0],a[0][1]-l[2][1],a[1][0]-l[3][0],a[1][1]-l[3][1],a[2][0]-l[0][0],a[2][1]-l[0][1],a[3][0]-l[1][0],a[3][1]-l[1][1]],n=0,s=o[n],c=1;c<o.length;c++)r(o[c])<s&&(n=c,s=r(o[c]));0==n%2?(this.vector.velx=0,this.vector.accelx=0,this.vector.x-=o[n]):(0<this.vector.vely&&(this.sticked=!0),this.vector.vely=0,this.vector.y-=o[n])}}},{key:"collisionBox",value:function(e){return new n.Rect(this.vector.x-e.rect.x+this.collision.x,this.vector.y-e.rect.y+this.collision.y,this.collision.w,this.collision.h)}},{key:"debug",value:function(e,t,a){var r={x:this.vector.x-t.rect.x,y:this.vector.y-t.rect.y,w:this.rect.x,h:this.rect.y};a&&(e.beginPath(),e.rect(this.collision.x+r.x,this.collision.y+r.y,this.collision.w||r.w,this.collision.h||r.h),e.lineWidth=1,e.strokeStyle="red",e.stroke(),e.beginPath(),e.rect(r.x,r.y,r.w,r.h),e.lineWidth=1,e.strokeStyle="blue",e.stroke()),e.font="12px Arial, sans-serif",e.fillStyle="black",e.fillText("Relative "+this.vector.x+" x "+this.vector.y,r.x+r.w+5,r.y+10),e.fillText("Real "+(this.vector.x-t.rect.x)+" x "+(this.vector.y-t.rect.y),r.x+r.w+5,r.y+24),e.fillText("Velocity "+this.vector.velx+" x "+this.vector.vely,r.x+r.w+5,r.y+38),e.fillText("Acceleration "+this.vector.accelx+" x "+this.vector.accely,r.x+r.w+5,r.y+52),e.fillText("State : "+this.sprite.state+(this.controlled?", controlled":""),r.x+r.w+5,r.y+66),e.fillText("Drawn : "+(a?"Yes":"No"),r.x+r.w+5,r.y+80)}},{key:"draw",value:function(e,t){var a=!1;if(this.shouldBeDrawn(t)){e.globalAlpha=this.effects.opacity;var r=this.sprite.draw(e,t.origin.x+this.vector.x-t.rect.x,t.origin.y+this.vector.y-t.rect.y,this.rect.x,this.rect.y);e.globalAlpha=1,a=!!r,this.options.useimagesize&&r&&(this.rect.x=r.w,this.rect.y=r.h)}return this.game.dev&&this.debug(e,t,a),a}},{key:"override",value:function(e,t){this.override[e]=t}},{key:"jump",value:function(){this.isOnFloor()&&(this.sticked=!1,this.override.jump?this.override.jump():this.vector.vely=-this.options.jumpheight)}},{key:"keyCommand",value:function(e,t){if(t)switch(e){case s.KEY_RIGHT:this.direction="right",this.keydown=!0,this.vector.setAcceleration(this.options.friction,this.vector.accely),this.sprite.changeState(this.sprite.state,"right");break;case s.KEY_LEFT:this.direction="left",this.keydown=!0,this.vector.setAcceleration(-this.options.friction,this.vector.accely),this.sprite.changeState(this.sprite.state,"left");break;case s.KEY_SPACE:case s.KEY_UP:this.jump();break;default:}else if(this.keydown&&(e==s.KEY_LEFT||e==s.KEY_RIGHT)){this.keydown=!1;var a="left"==this.direction?1:-1;-1==a&&0<this.vector.velx||1==a&&0>this.vector.velx?this.vector.setAcceleration(this.options.friction*a,this.vector.accely,!0):0!=this.vector.velx&&this.vector.setAcceleration(this.options.friction*-a,this.vector.accely,!0),this.sprite.changeState()}}},{key:"control",value:function(e){var t=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.controlled=!0,this.keyboard=e,i("GElement","Binding Graphic Element with keyboard controls"),a.arrows&&(this.keventleft=function(e,a,r){return t.keyCommand(e,a,r)},this.keventright=function(e,a,r){return t.keyCommand(e,a,r)},this.keventup=function(e,a,r){return t.keyCommand(e,a,r)},this.keventspace=function(e,a,r){return t.keyCommand(e,a,r)},e.bindKey("left",this.keventleft),e.bindKey("right",this.keventright),e.bindKey("up",this.keventup),e.bindKey("space",this.keventspace))}},{key:"giveupControl",value:function(){keyboard.killKey("left",this.keventleft),keyboard.killKey("right",this.keventright),keyboard.killKey("up",this.keventup),keyboard.killKey("space",this.keventspace)}},{key:"destroy",value:function(){i("GElement","Destroyed Graphic Element of type "+this.type),this.imagebitmap&&this.imagebitmap.close(),this.image&&this.image.remove(),this.controlled&&this.giveupControl()}},{key:"ready",get:function(){return this.sprite.currentState.ready}},{key:"collisionPoints",get:function(){return[[this.vector.x+this.collision.x+this.collision.w,this.vector.y+this.collision.y],[this.vector.x+this.collision.x,this.vector.y+this.collision.y],[this.vector.x+this.collision.x,this.vector.y+this.collision.y+this.collision.h],[this.vector.x+this.collision.x+this.collision.w,this.vector.y+this.collision.y+this.collision.h]]}}]),e}();t.exports=u},{"./dom":5,"./keyboard":9,"./log":10,"./physics":12,"./sprite":13,"./spriteset":14}],7:[function(e,t){(function(e){"use strict";var a=window;a.__SIDESCROLLGAME={env:"dev"},t.exports=a}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{}],8:[function(e,t){"use strict";function a(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=function(){function e(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),i=e("./log"),o=e("./camera"),n=e("./physics"),s=function(){function e(t,a){r(this,e),this.index=t,this.size=a,this.graphicselements=[],this._assocGE={}}return l(e,[{key:"addElement",value:function(e,t){return i("GraphicLayer","Added an element to layer "+this.index+" with id "+e),this.graphicselements.push(t),this._assocGE[e]=t,this}},{key:"clear",value:function(){return this.graphicselements.forEach(function(e){return e.destroy()}),this.graphicselements=[],this._assocGE={},this}},{key:"impactCheck",value:function(e,t){for(var a=0;a<this.graphicselements.length;a++){this.graphicselements[a].options.fixedtostage&&this.graphicselements[a].restrict(t,this.size);for(var r=a+1;r<this.graphicselements.length;r++)n.Collider.rectangles(this.graphicselements[a].collisionBox(t),this.graphicselements[r].collisionBox(t))&&(this.graphicselements[a].collide(e,this.graphicselements[r]),this.graphicselements[r].collide(e,this.graphicselements[a]))}return this}},{key:"updateStates",value:function(){return this.graphicselements.forEach(function(e){return e.updateState()}),this}},{key:"update",value:function(){return this.graphicselements.forEach(function(e){return e.update()}),this}},{key:"draw",value:function(e,t){return this.graphicselements.forEach(function(a){return a.draw(e,t)}),this}}]),e}(),c=function(){function e(t){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},l=arguments[2];r(this,e),this.context=this.c=t,this.options=Object.assign(e.defaultOptions(),a),this.size=l,this.camera=new o(a.origin.x,a.origin.y,t.width,t.height,a.verticalModifier),this.camera.setLimits(this.size),this.layers=[],this.fixedLayer=new s(-1,l);for(var n=0;n<a.layers;n++)this.layers.push(new s(n,l))}return l(e,null,[{key:"defaultOptions",value:function(){return{bgcolor:"#eaeff2"}}}]),l(e,[{key:"resize",value:function(e,t){this.w=e,this.h=t,this.rect=[0,0,this.w,this.h],this.camera.resize(this.w,this.h)}},{key:"clear",value:function(){var e;this.c.fillStyle=this.options.bgcolor,(e=this.c).fillRect.apply(e,a(this.rect))}},{key:"addElement",value:function(e,t,a){return a.id=t,this.layers[e].addElement(t,a),a}},{key:"update",value:function(){var e=this;this.camera.update(),this.layers.forEach(function(t){return t.update().impactCheck(e.context,e.camera).updateStates()})}},{key:"draw",value:function(){var e=this;this.layers.forEach(function(t){return t.draw(e.context,e.camera)})}}]),e}();t.exports=c},{"./camera":3,"./log":10,"./physics":12}],9:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),l=e("./log"),i=e("./glob"),o={up:38,down:40,left:37,right:39,space:32,shift:16,enter:13},n={};for(var s in o)n[s]=!1;var c=function(){function e(t){var r=this;a(this,e),this.canvas=t,l("Keyboard","Binding global key events"),this.keyEvents={13:[],16:[],32:[],37:[],38:[],39:[],40:[]},this.upEvents=[],i.addEventListener("keydown",function(e){r.down(e)}),i.addEventListener("keyup",function(e){r.up(e)})}return r(e,null,[{key:"KEY_UP",get:function(){return o.up}},{key:"KEY_DOWN",get:function(){return o.down}},{key:"KEY_LEFT",get:function(){return o.left}},{key:"KEY_RIGHT",get:function(){return o.right}},{key:"KEY_SPACE",get:function(){return o.space}},{key:"KEY_SHIFT",get:function(){return o.shift}},{key:"KEY_ENTER",get:function(){return o.enter}}]),r(e,[{key:"addKey",value:function(e,t){this.keyEvents[e]=t,o[t]=e,n[e]=!1,l("Keyboard","Registered new key "+t+" with byte "+e)}},{key:"down",value:function(e){this.keyEvents[e.which]&&!n[e.which]&&(n[e.which]=!0,this.keyEvents[e.which].forEach(function(t){return t(e.which,!0)}))}},{key:"keyToCode",value:function(e){return o[e]}},{key:"up",value:function(e){var t=this;if(this.keyEvents[e.which]&&n[e.which]){n[e.which]=!1,this.keyEvents[e.which].forEach(function(t){return t(e.which,!1)});var a=function(e){var a=o[e];n[a]&&t.keyEvents[a]&&t.keyEvents[a].forEach(function(e){return e(a,!0,!0)})};for(var r in o)a(r)}}},{key:"bindKey",value:function(e,t,a){l("Keyboard","Bound key with id "+e),this.keyEvents[o[e]||e].push(a?t.bind(a):t)}},{key:"killKey",value:function(e,t){var a=this.keyEvents[o[e]||e],r=a.indexOf(function(e){return e==t});-1!=r&&a.splice(r,1)}}]),e}();t.exports=c},{"./glob":7,"./log":10}],10:[function(e,t){"use strict";var a,r=e("./glob.js"),l=function(e,t){console.log("["+new Date+" - "+e+"] "+t),a&&a(e,t)};l.listen=function(e){a=e},t.exports="dev"==r.__SIDESCROLLGAME.env?l:function(){}},{"./glob.js":7}],11:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),l=e("./log"),i=e("./physics"),o=function(){function e(t){a(this,e),this.canvas=t,this.bindBasicEvents(),this.vector,this.bound={mousedown:[],mouseup:[]}}return r(e,[{key:"bindBasicEvents",value:function(){var e=this;this.canvas.addEventListener("mousedown",function(t){var a=1==t.which?"left":3==t.which?"right":"other";e.vector=new i.Vector2D(t.x,t.y),l("Mouse","Mouse down at "+t.x+" x "+t.y+", using "+a+" button"),e.bound.mousedown.forEach(function(e){return e()})}),this.canvas.addEventListener("mouseup",function(t){e.vector.to(t.x,t.y),l("Mouse","Mouse released at "+t.x+" x "+t.y+", distance of "+e.vector.length()+" px"),e.bound.mouseup.forEach(function(e){return e()})})}},{key:"bind",value:function(e,t,a){this.bound[e].push(t.bind(a))}},{key:"directBind",value:function(e,t,a){this.canvas.addEventListener(e,t.bind(a))}}]),e}();t.exports=o},{"./log":10,"./physics":12}],12:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=Math.abs,l=function(){function e(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),i=function(){function e(t,r,l,i){a(this,e),this.x=t,this.y=r,this.destx=l,this.desty=i,this.velx=0,this.vely=0,this.accelx=0,this.accely=0,this.maxvelx,this.maxvely}return l(e,[{key:"add",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"sub",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"at",value:function(e,t){this.x=e,this.y=t}},{key:"to",value:function(e,t){this.destx=e,this.desty=t}},{key:"setMaxVelocity",value:function(e,t){this.maxvelx=e,this.maxvely=t}},{key:"setVelocity",value:function(e,t){this.velx=e,this.vely=t}},{key:"setAcceleration",value:function(e,t,a,r){this.accelx=e,this.accely=t,this.breakatzerox=a,this.breakatzeroy=r}},{key:"update",value:function(){var e=this.velx,t=this.vely;this.velx+=this.accelx,this.vely+=this.accely,this.maxvelx&&r(this.velx)>this.maxvelx&&(this.velx=this.maxvelx*(0>this.velx?-1:1)),this.maxvely&&r(this.vely)>this.maxvely&&(this.vely=this.maxvely*(0>this.vely?-1:1)),this.breakatzerox&&(0<e&&0>=this.velx||0>e&&0<=this.velx)&&(this.accelx=0,this.velx=0),this.breakatzeroy&&(0<t&&0>this.vely||0>t&&0<this.vely)&&(this.accely=0,this.vely=0),this.x+=this.velx,this.y+=this.vely}},{key:"length",value:function(){var e=Math.pow;return Math.sqrt(e(this.x-this.destx,2)+e(this.y-this.desty,2))}}]),e}(),o=function(){function e(t,r,l,i){a(this,e),this.x=t,this.y=r,this.w=l,this.h=i}return l(e,[{key:"points",get:function(){return[[this.x,this.y+this.h],[this.x,this.y],[this.x+this.w,this.y],[this.x+this.w,this.y+this.h]]}}],[{key:"fromVectors2D",value:function(t,a){return new e(t.x,t.y,a.x,a.y)}},{key:"Points",value:function(t,a,r,l){return new e(t,a,r,l).points}}]),e}(),n=function(){function e(){a(this,e)}return l(e,null,[{key:"rectangles",value:function(e,t){return!(e.y+e.h<=t.y||e.y>=t.y+t.h||e.x+e.w<=t.x||e.x>=t.x+t.w)}},{key:"vectors",value:function(){}},{key:"vect2rect",value:function(){}}]),e}();t.exports={Vector2D:i,Rect:o,Collider:n}},{}],13:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),l=e("./log"),i=e("./physics"),o=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};for(var r in a(this,e),this.options=t,this.state=t.state||"neutral",this.facing=t.facing||"right",this.initialstate=this.state,this.pattern=t.pattern,this.spritesets={},t.spritesets||{})this.addState(r,t.spritesets[r])}return r(e,[{key:"createPattern",value:function(e,t){for(var a in this.pattern=!0,this.spritesets)this.spritesets[a].createPattern(e,t)}},{key:"addState",value:function(e,t){this.spritesets[e]=t}},{key:"changeState",value:function(e,t){var a=this.state;this.state=e||this.initialstate,this.facing=t||this.facing,this.currentState||(this.spritesets[this.state]=this.spritesets.neutral),a!=this.state&&this.currentState.resetFrame()}},{key:"updateState",value:function(){this.currentState.nextFrame()}},{key:"draw",value:function(e,t,a,r,l){var i;return e.save(),"right"==this.facing?this.useimagesize?i=this.currentState.draw(e,t,a):i=this.currentState.draw(e,t,a,r,l):"left"==this.facing&&(e.scale(-1,1),i=this.useimagesize?this.currentState.draw(e,-t-r,a):this.currentState.draw(e,-t-r,a,r,l),i.x=t),e.restore(),i}},{key:"currentState",get:function(){return this.spritesets[this.state]}}]),e}();t.exports=o},{"./log":10,"./physics":12}],14:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),l=e("./log"),i=e("./physics"),o=e("./dom"),n=function(){function e(t,r,i,o,n){if(a(this,e),this.type=t,this.url=r,this.frame=0,this.framestateupdate=o||!1,this.drew=0,this.ready=!1,this.totalstates=i||1,this.noloop=n,this.states=[],this.patterns=[],this.pattern=!1,l("SpriteSet","Creating new Sprite Set from "+this.url+" with "+this.totalstates+" states"),"singleimage"===t);else if("file"===t)this.load();else if("fileset"===t)this.load();else throw new Error("Created a SpriteSet with an invalid type : "+t)}return r(e,[{key:"getImageFromURL",value:function(e,t){var a=new Image;a.onload=function(){createImageBitmap(a).then(function(e){t(e)})},a.src=e}},{key:"resetFrame",value:function(){this.frame=0}},{key:"previousFrame",value:function(){this.frame--,0>this.frame&&(this.frame=this.totalstates-1)}},{key:"nextFrame",value:function(){this.frame++,this.frame==this.totalstates&&(this.frame=this.noloop?this.frame-1:0)}},{key:"load",value:function(e){var t=this;if("singleimage"==this.type);else{l("SpriteSet","Loading states from url scheme "+this.url);var a=-1,r=function r(){return++a==t.totalstates?(t.onready&&t.onready(),t.ready=!0,l("SpriteSet","Done loading states for SpriteSet with url "+t.url),e&&e()):void t.getImageFromURL(t.url.replace("$",a+1),function(e){t.states.push(e),r()})};r()}}},{key:"createPattern",value:function(e,t){var a=this;this.pattern=!0;var r=function(){a.states.forEach(function(r){var l=o.create({node:"canvas"});t||(t=new i.Vector2D(r.width,r.height)),l.width=t.x,l.height=t.y,l.getContext("2d").drawImage(r,0,0,t.x,t.y),a.patterns.push({pattern:e.createPattern(l,"repeat"),canvas:l})}),l("SpriteSet","Loaded pattern for "+a.states.length+" states")};this.ready?r():this.onready=r}},{key:"draw",value:function(e,t,a,r,l){if(this.ready)return t=t||0,a=a||0,r=r||this.currentFrame.width,l=l||this.currentFrame.height,this.pattern?(e.fillStyle=this.currentPattern.pattern,e.fillRect(t,a,r,l)):e.drawImage(this.currentFrame,t,a,r,l),this.drew++,this.framestateupdate&&this.drew==this.framestateupdate&&(this.drew=0,this.nextFrame()),new i.Rect(t,a,r,l)}},{key:"destroy",value:function(){this.patterns.forEach(function(e){e.canvas.remove(),e.pattern=void 0})}},{key:"currentFrame",get:function(){return this.states[this.frame]}},{key:"currentPattern",get:function(){return this.patterns[this.frame]}}]),e}();t.exports=n},{"./dom":5,"./log":10,"./physics":12}],15:[function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var a,r=0;r<t.length;r++)a=t[r],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),l=e("./log"),i=e("./physics"),o=e("./graphics"),n=function(){function e(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};a(this,e),this.context=t.context,this.audio=t.audio,this.stages=r,this.currentStage}return r(e,[{key:"createStage",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=arguments[2],r=arguments[3];if(!a&&this.stages[e])throw new Error("[World] Stage with id "+e+" already exists");var l=new s(e,this.context,t);return this.stages[e]=l,l.fire("added"),r&&this.switchStage(e),l}},{key:"switchStage",value:function(e){if(l("World","Switching to stage with id "+e),!this.stages[e])throw new Error("[World] Stage with id "+e+" does not exist");this.currentStage&&this.currentStage.fire("switchout"),this.currentStage=this.stages[e],this.currentStage.options.song&&this.audio.play(this.currentStage.options.song,0,0,!0),this.currentStage.fire("switchin")}},{key:"resize",value:function(e,t){for(var a in this.stages)this.stages[a].graphics.resize(e,t)}},{key:"update",value:function(){this.stage.update()}},{key:"draw",value:function(){this.stage.draw()}},{key:"hasStage",value:function(){return!!this.currentStage}},{key:"stage",get:function(){return this.currentStage}}]),e}(),s=function(){function e(t,r){var l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};a(this,e),this.id=t,this.options=Object.assign(e.defaultOptions(),l),this.context=r,this.graphics=new o(this.context,this.options,this.options.size)}return r(e,null,[{key:"defaultOptions",value:function(){return{size:new i.Vector2D(1920,1080),origin:new i.Vector2D(0,0),verticalModifier:1,song:void 0,hooks:{},layers:5}}}]),r(e,[{key:"fire",value:function(e,t){var a=this.options.hooks[e];a&&a(t)}},{key:"on",value:function(e,t){this.hooks[e]=t}},{key:"update",value:function(){this.graphics.update()}},{key:"draw",value:function(){this.graphics.clear(),this.graphics.draw()}},{key:"addElement",value:function(){var e;return(e=this.graphics).addElement.apply(e,arguments)}},{key:"follow",value:function(){var e;return(e=this.graphics.camera).follow.apply(e,arguments)}}]),e}();t.exports=n},{"./graphics":8,"./log":10,"./physics":12}]},{},[1]);
