(function b(c,d,e){function a(h,i){if(!d[h]){if(!c[h]){var j="function"==typeof require&&require;if(!i&&j)return j(h,!0);if(g)return g(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var f=d[h]={exports:{}};c[h][0].call(f.exports,function(b){var d=c[h][1][b];return a(d?d:b)},f,f.exports,b,c,d,e)}return d[h].exports}for(var g="function"==typeof require&&require,f=0;f<e.length;f++)a(e[f]);return a})({1:[function(a){"use strict";function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var c=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),d=a("./lib/glob"),e=a("./lib/log"),f=a("./lib/debugger"),g=a("./lib/mouse"),h=a("./lib/graphics"),i=a("./lib/spriteset"),j=a("./lib/sprite"),k=a("./lib/gelement"),l=a("./lib/physics"),m=a("./lib/keyboard"),n=function(){function a(c){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(b(this,a),this.canvas="string"==typeof c?document.getElementById(c):c,!this.canvas)throw new Error("Undefined canvas ID");this.context=this.c=this.canvas.getContext("2d"),this.options=Object.assign(a.defaults(),e),this.gamedebugger=new f(this.canvas),this.graphics=new h(this.context,this.options),this.mouse=new g(this.canvas),this.keyboard=new m(this.canvas),"dev"==this.options.env?("dev"==d.__SIDESCROLLGAME.env,this.gamedebugger.cast()):d.__SIDESCROLLGAME.env==this.options.env||"prod",this.timing={delta:0,ctime:0,frame:0,framerate:1e3/this.options.fps},this.arrangeBody(),this.bindResize(),this.resize()}return c(a,null,[{key:"defaults",value:function(){return{bgcolor:"#eaeff2",fps:60,layers:5,env:"prod"}}}]),c(a,[{key:"arrangeBody",value:function(){document.body.style.margin=0,document.body.style.padding=0}},{key:"resize",value:function(){this.canvas.width=d.innerWidth,this.canvas.height=d.innerHeight,this.graphics.resize(d.innerWidth,d.innerHeight),e("Game","Handled resized at "+d.innerWidth+" x "+d.innerHeight)}},{key:"bindResize",value:function(){var a=this;d.addEventListener("resize",function(){return a.resize()})}},{key:"start",value:function(){var a=this;return e("Game","Starting engine"),this.frameRequest=requestAnimationFrame(function(b){a.draw(b)}),this}},{key:"update",value:function(){return this.graphics.clear(),this.graphics.draw(),this.gamedebugger.ping(),this}},{key:"draw",value:function(a){var b=this,c=this.timing.ctime-a;return c<this.timing.framerate&&(this.timing.ctime=a,this.timing.frame++,this.update()),this.frameRequest=requestAnimationFrame(function(a){b.draw(a)}),this}}]),a}();d.SideQuest={Game:n,SpriteSet:i,Sprite:j,GraphicElement:k,Physics:l,Keyboard:m,Mouse:g,log:e}},{"./lib/debugger":2,"./lib/gelement":4,"./lib/glob":5,"./lib/graphics":6,"./lib/keyboard":7,"./lib/log":8,"./lib/mouse":9,"./lib/physics":10,"./lib/sprite":11,"./lib/spriteset":12}],2:[function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a("./log"),g=a("./dom"),d=a("./glob"),h=function(){function a(b){c(this,a),this.pingcount=0,this.init=!1,this.canvas=b}return e(a,[{key:"createElem",value:function(){this.elem=g.create({node:"div",id:"gamedebugger",parent:document.body,children:[{node:"div",id:"debugframecount"},{node:"div",id:"debugfps"}]}),this.outputelem=g.create({node:"div",id:"debugoutput",parent:this.elem}),this.init=!0}},{key:"bindError",value:function(){var f=this;d.onerror=function(g,a,b,c,d){return f.error(g,a,b,c,d)}}},{key:"addStylesheet",value:function(){g.create({node:"link",attr:{rel:"stylesheet",href:"/debug.css"},parent:document.head})}},{key:"report",value:function(){}},{key:"ping",value:function(){this.pingcount++,this.init&&(g.byID("debugframecount").textContent=this.pingcount+" frames")}},{key:"startFPS",value:function(){var a=this;this.lastpingat=0;setTimeout(function b(){g.byID("debugfps").textContent=a.pingcount-a.lastpingat+" FPS",a.lastpingat=a.pingcount,setTimeout(b,1e3)},1e3)}},{key:"log",value:function(a,b){g.create({node:"div",text:"["+new Date().toLocaleTimeString()+" - "+a+"] - "+b,parent:this.outputelem}),this.elem.scrollTop=this.outputelem.scrollHeight}},{key:"bindCanvasEvents",value:function(){}},{key:"cast",value:function(){var a=this;this.createElem(),this.addStylesheet(),this.bindError(),this.bindCanvasEvents(),this.startFPS(),f.listen(function(b,c){return a.log(b,c)}),f("Debugger","Created debugger"),this.elem.classList.add("shown")}},{key:"error",value:function(a,b,c,d,e){g.create({node:"div",text:a,attr:{style:"color : red;"},parent:this.outputelem}),g.create({node:"pre",html:e&&e.stack,attr:{style:"color : red;"},parent:this.outputelem})}}]),a}();b.exports=h},{"./dom":3,"./glob":5,"./log":8}],3:[function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=function(){function a(){c(this,a)}return d(a,[{key:"create",value:function(a){if("text"==a.node)return document.createTextNode(a.text);var b=document.createElement(a.node);if(a.id&&(b.id=a.id),b.className=a.className||a.classList&&a.classList.join(" ")||"",a.attr)for(var c=Object.keys(a.attr),d=0;d<c.length;d++)b.setAttribute(c[d],a.attr[c[d]]);if(a.text?b.textContent=a.text:a.html&&(b.innerHTML=a.html),a.children)for(var d=0;d<a.children.length;d++)b.appendChild(this.create(a.children[d]));return a.parent&&a.parent.appendChild(b),b}},{key:"byID",value:function(a){return document.getElementById(a)}},{key:"query",value:function(a,b){return document[b?"querySelectorAll":"querySelector"](a)}}]),a}();b.exports=new e},{}],4:[function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a("./log"),g=a("./dom"),d=a("./physics"),h=a("./keyboard"),i={x:0,y:0,w:0,h:0,initspeed:1,maxspeed:3,controlled:!1,friction:0.2},j=function(){function a(b,e){switch(c(this,a),this.ready=!1,this.type=b,this.options=Object.assign(i,e||{}),this.vector=new d.Vector2D(this.options.x,this.options.y),this.rect=new d.Vector2D(this.options.w,this.options.h),this.vector.setMaxVelocity(this.options.maxspeed,this.options.maxspeed),this.controlled=this.options.controlled,this.key,this.type){case"image":this.initImage(this.options.url),this.options.preload&&this.preload();break;case"sprite":this.initSprite(this.options.sprite);break;case"shape":this.initShape(e);break;default:throw new Error("GElement was created without an invalid type : "+this.type);}f("GElement","Created a new Graphic Element of type "+this.type)}return e(a,[{key:"setPosition",value:function(a,b){this.vector.at(a,b)}},{key:"initSprite",value:function(a){this.sprite=a,this.key=a,this.draw=this.drawSprite}},{key:"initImage",value:function(a){this.url=a,this.image=new Image,this.key=this.image,this.draw=this.drawImage,f("GElement","Initialized Graphic Element with image at "+this.url)}},{key:"preload",value:function(){var a=this;this.image.onload=function(){createImageBitmap(a.image).then(function(b){a.imagebitmap=b,a.rect.w||a.rect.h||a.rect.at(a.imagebitmap.width,a.imagebitmap.height),f("GElement","Preloaded Graphic Element with image at "+a.url),a.ready=!0,a.options.preloadcallback&&a.options.preloadcallback(a)})},this.image.src=this.url}},{key:"initShape",value:function(){}},{key:"drawImage",value:function(a){this.vector.update(),this.imagebitmap&&a.drawImage(this.imagebitmap,this.vector.x,this.vector.y,this.rect.x,this.rect.y)}},{key:"drawSprite",value:function(a){this.vector.update(),this.sprite.draw(a,this.vector.x,this.vector.y,this.rect.x,this.rect.y)}},{key:"drawShape",value:function(){}},{key:"draw",value:function(){throw new Error("Tried to draw a GElement with an invalid type : "+this.type)}},{key:"keyCommand",value:function(a,b){if(b)switch(a){case h.KEY_RIGHT:this.vector.setVelocity(this.options.initspeed,this.vector.vely),this.direction="right",this.keydown=!0,this.vector.setAcceleration(this.options.friction,this.vector.accely),this.sprite&&this.sprite.changeState(this.movingstate,"right");break;case h.KEY_LEFT:this.vector.setVelocity(-this.options.initspeed,this.vector.vely),this.direction="left",this.keydown=!0,this.vector.setAcceleration(-this.options.friction,this.vector.accely),this.sprite&&this.sprite.changeState(this.movingstate,"left");break;default:}else if(this.keydown&&(a==h.KEY_LEFT||a==h.KEY_RIGHT)){this.keydown=!1;var c="left"==this.direction?1:-1;this.vector.setAcceleration(this.options.friction*c,this.vector.accely,!0),this.sprite&&this.sprite.changeState()}}},{key:"control",value:function(a){var b=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.controlled=!0,this.keyboard=a,this.movingstate=c.movingstate||"running",f("GElement","Binding Graphic Element with keyboard controls"),c.arrows&&(this.keventleft=function(a,c){return b.keyCommand(a,c)},this.keventright=function(a,c){return b.keyCommand(a,c)},a.bindKey("left",this.keventleft),a.bindKey("right",this.keventright))}},{key:"giveupControll",value:function(){keyboard.killKey("left",this.keventleft),keyboard.killKey("right",this.keventright)}},{key:"destroy",value:function(){f("GElement","Destroyed Graphic Element of type "+this.type),this.imagebitmap&&this.imagebitmap.close(),this.image&&this.image.remove(),this.controlled&&this.giveupControll()}}]),a}();b.exports=j},{"./dom":3,"./keyboard":7,"./log":8,"./physics":10}],5:[function(a,b){(function(a){"use strict";var c=window;c.__SIDESCROLLGAME={env:"dev"},b.exports=c}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{}],6:[function(a,b){"use strict";function c(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a("./log"),g=function(){function a(b){d(this,a),this.index=b,this.graphicselements=[],this._assocGE={}}return e(a,[{key:"addElement",value:function(a,b){f("GraphicLayer","Added an element to layer "+this.index+" with id "+a),this.graphicselements.push(b),this._assocGE[a]=b}},{key:"clear",value:function(){this.graphicselements.forEach(function(a){return a.destroy()}),this.graphicselements=[],this._assocGE={}}},{key:"draw",value:function(a){this.graphicselements.forEach(function(b){return b.draw(a)})}}]),a}(),h=function(){function a(b,c){d(this,a),this.context=this.c=b,this.options=c,this.layers=[],this.fixedLayer=new g(-1);for(var e=0;e<c.layers;e++)this.layers.push(new g(e))}return e(a,[{key:"resize",value:function(a,b){this.w=a,this.h=b,this.rect=[0,0,this.w,this.h]}},{key:"clear",value:function(){var a;this.c.fillStyle=this.options.bgcolor,(a=this.c).fillRect.apply(a,c(this.rect))}},{key:"addElement",value:function(a,b,c){this.layers[a].addElement(b,c)}},{key:"draw",value:function(){var a=this;this.layers.forEach(function(b){return b.draw(a.context)})}}]),a}();b.exports=h},{"./log":8}],7:[function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a("./log"),f=a("./glob"),g={up:38,down:40,left:37,right:39,space:32,shift:16,enter:13},h={};for(var i in g)h[i]=!1;var j=function(){function a(b){var d=this;c(this,a),this.canvas=b,e("Keyboard","Binding global key events"),this.keyEvents={13:[],16:[],32:[],37:[],38:[],39:[],40:[]},this.upEvents=[],f.addEventListener("keydown",function(a){d.down(a)}),f.addEventListener("keyup",function(a){d.up(a)})}return d(a,null,[{key:"KEY_UP",get:function(){return g.up}},{key:"KEY_DOWN",get:function(){return g.down}},{key:"KEY_LEFT",get:function(){return g.left}},{key:"KEY_RIGHT",get:function(){return g.right}},{key:"KEY_SPACE",get:function(){return g.space}},{key:"KEY_SHIFT",get:function(){return g.shift}},{key:"KEY_ENTER",get:function(){return g.enter}}]),d(a,[{key:"addKey",value:function(a,b){this.keyEvents[a]=b,g[b]=a,h[a]=!1}},{key:"down",value:function(a){this.keyEvents[a.which]&&!h[a.which]&&(h[a.which]=!0,this.keyEvents[a.which].forEach(function(b){return b(a.which,!0)}))}},{key:"keyToCode",value:function(a){return g[a]}},{key:"up",value:function(a){h[a.which]=!1,this.keyEvents[a.which].forEach(function(b){return b(a.which,!1)})}},{key:"bindKey",value:function(a,b,c){e("Keyboard","Bound key with id "+a),this.keyEvents[g[a]||a].push(c?b.bind(c):b)}},{key:"killKey",value:function(a,b){var c=this.keyEvents[g[a]||a],d=c.indexOf(function(a){return a==b});-1!=d&&c.splice(d,1)}}]),a}();b.exports=j},{"./glob":5,"./log":8}],8:[function(a,b){"use strict";var c,d=a("./glob.js"),e=function(a,b){console.log("["+new Date+" - "+a+"] "+b),c&&c(a,b)};e.listen=function(a){c=a},b.exports="dev"==d.__SIDESCROLLGAME.env?e:function(){}},{"./glob.js":5}],9:[function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a("./log"),f=a("./physics"),g=function(){function a(b){c(this,a),this.canvas=b,this.bindBasicEvents(),this.vector,this.bound={mousedown:[],mouseup:[]}}return d(a,[{key:"bindBasicEvents",value:function(){var a=this;this.canvas.addEventListener("mousedown",function(b){var c=1==b.which?"left":3==b.which?"right":"other";a.vector=new f.Vector2D(b.x,b.y),e("Mouse","Mouse down at "+b.x+" x "+b.y+", using "+c+" button"),a.bound.mousedown.forEach(function(a){return a()})}),this.canvas.addEventListener("mouseup",function(b){a.vector.to(b.x,b.y),e("Mouse","Mouse released at "+b.x+" x "+b.y+", distance of "+a.vector.length()+" px"),a.bound.mouseup.forEach(function(a){return a()})})}},{key:"bind",value:function(a,b,c){this.bound[a].push(b.bind(c))}},{key:"directBind",value:function(a,b,c){this.canvas.addEventListener(a,b.bind(c))}}]),a}();b.exports=g},{"./log":8,"./physics":10}],10:[function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=function(){function a(b,d,e,f){c(this,a),this.x=b,this.y=d,this.destx=e,this.desty=f,this.velx=0,this.vely=0,this.accelx=0,this.accely=0,this.maxvelx,this.maxvely}return d(a,[{key:"at",value:function(a,b){this.x=a,this.y=b}},{key:"to",value:function(a,b){this.destx=a,this.desty=b}},{key:"setMaxVelocity",value:function(a,b){this.maxvelx=a,this.maxvely=b}},{key:"setVelocity",value:function(a,b){this.velx=a,this.vely=b}},{key:"setAcceleration",value:function(a,b,c,d){this.accelx=a,this.accely=b,this.breakatzerox=c,this.breakatzeroy=d}},{key:"update",value:function(){var a=Math.abs,b=this.velx,c=this.vely;this.velx+=this.accelx,this.vely+=this.accely,this.maxvelx&&a(this.velx)>this.maxvelx&&(this.velx=this.maxvelx*(0>this.velx?-1:1)),this.maxvely&&a(this.vely)>this.maxvely&&(this.vely=this.maxvely*(0>this.vely?-1:1)),this.breakatzerox&&(0<b&&0>this.velx||0>b&&0<this.velx)&&(this.accelx=0,this.velx=0),this.breakatzeroy&&(0<c&&0>this.vely||0>c&&0<this.vely)&&(this.accely=0,this.vely=0),this.x+=this.velx,this.y+=this.vely}},{key:"length",value:function(){var a=Math.pow;return Math.sqrt(a(this.x-this.destx,2)+a(this.y-this.desty,2))}}]),a}();b.exports={Vector2D:e}},{}],11:[function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a("./log"),f=a("./physics"),g=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};c(this,a),this.options=b,this.state=b.state||"neutral",this.initialstate=this.state,this.spritesets=b.spritesets||{},this.facing=b.facing||"right"}return d(a,[{key:"addState",value:function(a,b){this.spritesets[a]=b}},{key:"changeState",value:function(a,b){this.state=a||this.initialstate,this.facing=b||this.facing}},{key:"updateState",value:function(){this.currentState.nextFrame()}},{key:"draw",value:function(a,b,c,d,e){a.save(),"right"==this.facing?this.currentState.draw(a,b,c,d,e):"left"==this.facing&&(a.scale(-1,1),this.currentState.draw(a,-b-d,c,d,e)),a.restore()}},{key:"currentState",get:function(){return this.spritesets[this.state]}}]),a}();b.exports=g},{"./log":8,"./physics":10}],12:[function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a("./log"),f=function(){function a(b,d,f,g){if(c(this,a),this.type=b,this.url=d,this.frame=0,this.framestateupdate=g||10,this.drew=0,this.ready=!1,this.totalstates=f,this.states=[],e("SpriteSet","Creating new Sprite Set from "+d+" with "+f+" states"),"singleimage"===b);else if("fileset"===b)this.load();else throw new Error("Created a SpriteSet with an invalid type : "+b)}return d(a,[{key:"getImageFromURL",value:function(a,b){var c=new Image;c.onload=function(){createImageBitmap(c).then(function(a){b(a)})},c.src=a}},{key:"previousFrame",value:function(){this.frame--,0>this.frame&&(this.frame=this.totalstates-1)}},{key:"nextFrame",value:function(){this.frame++,this.frame==this.totalstates&&(this.frame=0)}},{key:"load",value:function(a){var b=this;if("singleimage"==this.type);else if("fileset"==this.type){e("SpriteSet","Loading states from url scheme "+this.url);var c=-1,d=function d(){return++c==b.totalstates?(b.ready=!0,e("SpriteSet","Done loading states for SpriteSet with url "+b.url),a&&a()):void b.getImageFromURL(b.url.replace("$",c+1),function(a){b.states.push(a),d()})};d()}}},{key:"draw",value:function(a,b,c,d,e){this.ready&&a.drawImage(this.currentFrame,b,c,d,e),this.drew++,this.drew==this.framestateupdate&&(this.drew=0,this.nextFrame())}},{key:"destroy",value:function(){}},{key:"currentFrame",get:function(){return this.states[this.frame]}}]),a}();b.exports=f},{"./log":8}]},{},[1]);
